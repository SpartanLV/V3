{"ast":null,"code":"var _jsxFileName = \"D:\\\\Spring2025\\\\CSE470\\\\CSE470 Project\\\\V3\\\\frontend\\\\src\\\\components\\\\ChatBox.js\",\n  _s = $RefreshSig$();\n// frontend/src/components/ChatBox.js\nimport React, { useEffect, useState, useRef } from 'react';\nimport { setupSocket, subscribeToMessages, subscribeToMessageSent, sendMessageWS, disconnectSocket } from '../services/socket';\nimport api from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatBox = ({\n  recipient,\n  currentUserId\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const bottomRef = useRef(null);\n\n  // Scroll to the bottom whenever messages change\n  const scrollToBottom = () => {\n    var _bottomRef$current;\n    (_bottomRef$current = bottomRef.current) === null || _bottomRef$current === void 0 ? void 0 : _bottomRef$current.scrollIntoView({\n      behavior: 'smooth'\n    });\n  };\n  useEffect(() => {\n    // Early bail if we lack either ID\n    if (!(recipient !== null && recipient !== void 0 && recipient._id) || !currentUserId) {\n      console.warn('ChatBox: missing recipient or current user ID');\n      return;\n    }\n\n    // 1) Load existing messages\n    const fetchMessages = async () => {\n      try {\n        const res = await api.get('/messages');\n        const twoWay = res.data.filter(msg => msg.sender === currentUserId && msg.recipient === recipient._id || msg.sender === recipient._id && msg.recipient === currentUserId);\n        setMessages(twoWay);\n        scrollToBottom();\n      } catch (err) {\n        console.error('Error loading messages:', err);\n      }\n    };\n    fetchMessages();\n\n    // 2) Setup socket listeners\n    setupSocket();\n    const handler = msg => {\n      // only append if this message is between us\n      if (msg.sender === currentUserId && msg.recipient === recipient._id || msg.sender === recipient._id && msg.recipient === currentUserId) {\n        setMessages(prev => [...prev, msg]);\n        scrollToBottom();\n      }\n    };\n    subscribeToMessages(handler);\n    subscribeToMessageSent(handler);\n\n    // 3) Cleanup on unmount or recipient change\n    return () => {\n      disconnectSocket();\n      setMessages([]); // reset chat window\n    };\n  }, [recipient, currentUserId]);\n  const handleSend = e => {\n    e.preventDefault();\n    // Guard again before sending\n    if (!input.trim() || !(recipient !== null && recipient !== void 0 && recipient._id) || !currentUserId) {\n      console.warn('ChatBox: missing recipient or current user ID');\n      return;\n    }\n    // send over WebSocket (server will tag sender via token)\n    sendMessageWS(recipient._id, input.trim());\n    setInput('');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chatbox\",\n    style: {\n      border: '1px solid #ccc',\n      padding: 12,\n      borderRadius: 8\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        height: 300,\n        overflowY: 'auto',\n        marginBottom: 8\n      },\n      children: [messages.map(msg => /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: msg.sender === currentUserId ? 'right' : 'left',\n          marginBottom: 4\n        },\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            background: msg.sender === currentUserId ? '#b3d4fc' : '#eee',\n            padding: '6px 10px',\n            borderRadius: 12,\n            display: 'inline-block',\n            maxWidth: '80%',\n            wordWrap: 'break-word'\n          },\n          children: msg.body\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }, this)\n      }, msg._id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: bottomRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSend,\n      style: {\n        display: 'flex'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        placeholder: \"Type a message...\",\n        style: {\n          flex: 1,\n          padding: '8px',\n          border: '1px solid #ccc',\n          borderRadius: '4px',\n          marginRight: '8px',\n          fontSize: '14px'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        style: {\n          padding: '8px 12px',\n          border: '1px solid #ccc',\n          borderRadius: '4px',\n          cursor: 'pointer'\n        },\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatBox, \"fgDbM/vrhbelCp+9Dh8Cjohw9/E=\");\n_c = ChatBox;\nexport default ChatBox;\nvar _c;\n$RefreshReg$(_c, \"ChatBox\");","map":{"version":3,"names":["React","useEffect","useState","useRef","setupSocket","subscribeToMessages","subscribeToMessageSent","sendMessageWS","disconnectSocket","api","jsxDEV","_jsxDEV","ChatBox","recipient","currentUserId","_s","messages","setMessages","input","setInput","bottomRef","scrollToBottom","_bottomRef$current","current","scrollIntoView","behavior","_id","console","warn","fetchMessages","res","get","twoWay","data","filter","msg","sender","err","error","handler","prev","handleSend","e","preventDefault","trim","className","style","border","padding","borderRadius","children","height","overflowY","marginBottom","map","textAlign","background","display","maxWidth","wordWrap","body","fileName","_jsxFileName","lineNumber","columnNumber","ref","onSubmit","type","value","onChange","target","placeholder","flex","marginRight","fontSize","cursor","_c","$RefreshReg$"],"sources":["D:/Spring2025/CSE470/CSE470 Project/V3/frontend/src/components/ChatBox.js"],"sourcesContent":["// frontend/src/components/ChatBox.js\r\nimport React, { useEffect, useState, useRef } from 'react';\r\nimport {\r\n  setupSocket,\r\n  subscribeToMessages,\r\n  subscribeToMessageSent,\r\n  sendMessageWS,\r\n  disconnectSocket,\r\n} from '../services/socket';\r\nimport api from '../services/api';\r\n\r\nconst ChatBox = ({ recipient, currentUserId }) => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState('');\r\n  const bottomRef = useRef(null);\r\n\r\n  // Scroll to the bottom whenever messages change\r\n  const scrollToBottom = () => {\r\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Early bail if we lack either ID\r\n    if (!recipient?._id || !currentUserId) {\r\n      console.warn('ChatBox: missing recipient or current user ID');\r\n      return;\r\n    }\r\n\r\n    // 1) Load existing messages\r\n    const fetchMessages = async () => {\r\n      try {\r\n        const res = await api.get('/messages');\r\n        const twoWay = res.data.filter(msg =>\r\n          (msg.sender === currentUserId && msg.recipient === recipient._id) ||\r\n          (msg.sender === recipient._id && msg.recipient === currentUserId)\r\n        );\r\n        setMessages(twoWay);\r\n        scrollToBottom();\r\n      } catch (err) {\r\n        console.error('Error loading messages:', err);\r\n      }\r\n    };\r\n\r\n    fetchMessages();\r\n\r\n    // 2) Setup socket listeners\r\n    setupSocket();\r\n    const handler = (msg) => {\r\n      // only append if this message is between us\r\n      if (\r\n        (msg.sender === currentUserId && msg.recipient === recipient._id) ||\r\n        (msg.sender === recipient._id && msg.recipient === currentUserId)\r\n      ) {\r\n        setMessages(prev => [...prev, msg]);\r\n        scrollToBottom();\r\n      }\r\n    };\r\n    subscribeToMessages(handler);\r\n    subscribeToMessageSent(handler);\r\n\r\n    // 3) Cleanup on unmount or recipient change\r\n    return () => {\r\n      disconnectSocket();\r\n      setMessages([]);  // reset chat window\r\n    };\r\n\r\n  }, [recipient, currentUserId]);\r\n\r\n  const handleSend = (e) => {\r\n    e.preventDefault();\r\n    // Guard again before sending\r\n    if (!input.trim() || !recipient?._id || !currentUserId) {\r\n      console.warn('ChatBox: missing recipient or current user ID');\r\n      return;\r\n    }\r\n    // send over WebSocket (server will tag sender via token)\r\n    sendMessageWS(recipient._id, input.trim());\r\n    setInput('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"chatbox\" style={{ border: '1px solid #ccc', padding: 12, borderRadius: 8 }}>\r\n      <div style={{ height: 300, overflowY: 'auto', marginBottom: 8 }}>\r\n        {messages.map((msg) => (\r\n          <div\r\n            key={msg._id}\r\n            style={{\r\n              textAlign: msg.sender === currentUserId ? 'right' : 'left',\r\n              marginBottom: 4,\r\n            }}\r\n          >\r\n            <span\r\n              style={{\r\n                background: msg.sender === currentUserId ? '#b3d4fc' : '#eee',\r\n                padding: '6px 10px',\r\n                borderRadius: 12,\r\n                display: 'inline-block',\r\n                maxWidth: '80%',\r\n                wordWrap: 'break-word',\r\n              }}\r\n            >\r\n              {msg.body}\r\n            </span>\r\n          </div>\r\n        ))}\r\n        <div ref={bottomRef} />\r\n      </div>\r\n\r\n      <form onSubmit={handleSend} style={{ display: 'flex' }}>\r\n        <input\r\n          type=\"text\"\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          placeholder=\"Type a message...\"\r\n          style={{\r\n            flex: 1,\r\n            padding: '8px',\r\n            border: '1px solid #ccc',\r\n            borderRadius: '4px',\r\n            marginRight: '8px',\r\n            fontSize: '14px',\r\n          }}\r\n        />\r\n        <button\r\n          type=\"submit\"\r\n          style={{\r\n            padding: '8px 12px',\r\n            border: '1px solid #ccc',\r\n            borderRadius: '4px',\r\n            cursor: 'pointer',\r\n          }}\r\n        >\r\n          Send\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatBox;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}