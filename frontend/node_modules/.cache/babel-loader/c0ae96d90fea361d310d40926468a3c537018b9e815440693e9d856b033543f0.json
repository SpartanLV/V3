{"ast":null,"code":"var _jsxFileName = \"D:\\\\Spring2025\\\\CSE470\\\\CSE470 Project\\\\V3\\\\frontend\\\\src\\\\components\\\\ChatBox.js\",\n  _s = $RefreshSig$();\n// frontend/src/components/ChatBox.js\nimport React, { useEffect, useState, useRef } from 'react';\nimport { setupSocket, subscribeToMessages, subscribeToMessageSent, sendMessageWS, disconnectSocket } from '../services/socket';\nimport api from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatBox = ({\n  recipient\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const bottomRef = useRef(null);\n\n  // Scroll to the bottom\n  const scrollToBottom = () => {\n    var _bottomRef$current;\n    (_bottomRef$current = bottomRef.current) === null || _bottomRef$current === void 0 ? void 0 : _bottomRef$current.scrollIntoView({\n      behavior: 'smooth'\n    });\n  };\n  useEffect(() => {\n    const fetchMessages = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        const res = await axios.get('/api/messages', {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        const filtered = res.data.filter(msg => msg.sender === recipient._id || msg.recipient === recipient._id);\n        setMessages(filtered);\n      } catch (err) {\n        console.error('Error loading messages:', err);\n      }\n    };\n    fetchMessages();\n    const socket = setupSocket();\n\n    // Listen for incoming messages\n    subscribeToMessages(msg => {\n      if (msg.sender === recipient._id || msg.recipient === recipient._id) {\n        setMessages(prev => [...prev, msg]);\n        scrollToBottom();\n      }\n    });\n    subscribeToMessageSent(msg => {\n      if (msg.sender === recipient._id || msg.recipient === recipient._id) {\n        setMessages(prev => [...prev, msg]);\n        scrollToBottom();\n      }\n    });\n    return () => {\n      disconnectSocket();\n    };\n  }, [recipient]);\n  const handleSend = e => {\n    e.preventDefault();\n    if (!input.trim()) return;\n    sendMessageWS(recipient._id, input.trim());\n    setInput('');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chatbox\",\n    style: {\n      border: '1px solid #ccc',\n      padding: 12,\n      borderRadius: 8\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        height: 300,\n        overflowY: 'auto',\n        marginBottom: 8\n      },\n      children: [messages.map(msg => /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: msg.sender === recipient._id ? 'left' : 'right',\n          marginBottom: 4\n        },\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            background: msg.sender === recipient._id ? '#eee' : '#b3d4fc',\n            padding: '6px 10px',\n            borderRadius: 12,\n            display: 'inline-block',\n            maxWidth: '80%',\n            wordWrap: 'break-word'\n          },\n          children: msg.body\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 13\n        }, this)\n      }, msg._id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: bottomRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSend,\n      style: {\n        display: 'flex'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        placeholder: \"Type a message...\",\n        style: {\n          flex: 1,\n          padding: '8px',\n          border: '1px solid #ccc',\n          borderRadius: '4px',\n          marginRight: '8px',\n          fontSize: '14px'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        style: {\n          padding: '8px 12px',\n          border: '1px solid #ccc',\n          borderRadius: '4px',\n          cursor: 'pointer'\n        },\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatBox, \"fgDbM/vrhbelCp+9Dh8Cjohw9/E=\");\n_c = ChatBox;\nexport default ChatBox;\nvar _c;\n$RefreshReg$(_c, \"ChatBox\");","map":{"version":3,"names":["React","useEffect","useState","useRef","setupSocket","subscribeToMessages","subscribeToMessageSent","sendMessageWS","disconnectSocket","api","jsxDEV","_jsxDEV","ChatBox","recipient","_s","messages","setMessages","input","setInput","bottomRef","scrollToBottom","_bottomRef$current","current","scrollIntoView","behavior","fetchMessages","token","localStorage","getItem","res","axios","get","headers","Authorization","filtered","data","filter","msg","sender","_id","err","console","error","socket","prev","handleSend","e","preventDefault","trim","className","style","border","padding","borderRadius","children","height","overflowY","marginBottom","map","textAlign","background","display","maxWidth","wordWrap","body","fileName","_jsxFileName","lineNumber","columnNumber","ref","onSubmit","type","value","onChange","target","placeholder","flex","marginRight","fontSize","cursor","_c","$RefreshReg$"],"sources":["D:/Spring2025/CSE470/CSE470 Project/V3/frontend/src/components/ChatBox.js"],"sourcesContent":["// frontend/src/components/ChatBox.js\r\nimport React, { useEffect, useState, useRef } from 'react';\r\nimport {\r\n  setupSocket,\r\n  subscribeToMessages,\r\n  subscribeToMessageSent,\r\n  sendMessageWS,\r\n  disconnectSocket,\r\n} from '../services/socket';\r\nimport api from '../services/api';\r\n\r\nconst ChatBox = ({ recipient }) => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState('');\r\n  const bottomRef = useRef(null);\r\n\r\n  // Scroll to the bottom\r\n  const scrollToBottom = () => {\r\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchMessages = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        const res = await axios.get('/api/messages', {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        const filtered = res.data.filter(\r\n          (msg) =>\r\n            (msg.sender === recipient._id || msg.recipient === recipient._id)\r\n        );\r\n        setMessages(filtered);\r\n      } catch (err) {\r\n        console.error('Error loading messages:', err);\r\n      }\r\n    };\r\n\r\n    fetchMessages();\r\n    const socket = setupSocket();\r\n\r\n    // Listen for incoming messages\r\n    subscribeToMessages((msg) => {\r\n      if (\r\n        msg.sender === recipient._id ||\r\n        msg.recipient === recipient._id\r\n      ) {\r\n        setMessages((prev) => [...prev, msg]);\r\n        scrollToBottom();\r\n      }\r\n    });\r\n\r\n    subscribeToMessageSent((msg) => {\r\n      if (\r\n        msg.sender === recipient._id ||\r\n        msg.recipient === recipient._id\r\n      ) {\r\n        setMessages((prev) => [...prev, msg]);\r\n        scrollToBottom();\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      disconnectSocket();\r\n    };\r\n  }, [recipient]);\r\n\r\n  const handleSend = (e) => {\r\n    e.preventDefault();\r\n    if (!input.trim()) return;\r\n    sendMessageWS(recipient._id, input.trim());\r\n    setInput('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"chatbox\" style={{ border: '1px solid #ccc', padding: 12, borderRadius: 8 }}>\r\n      <div style={{ height: 300, overflowY: 'auto', marginBottom: 8 }}>\r\n        {messages.map((msg) => (\r\n          <div\r\n            key={msg._id}\r\n            style={{\r\n              textAlign: msg.sender === recipient._id ? 'left' : 'right',\r\n              marginBottom: 4,\r\n            }}\r\n          >\r\n            <span\r\n              style={{\r\n                background: msg.sender === recipient._id ? '#eee' : '#b3d4fc',\r\n                padding: '6px 10px',\r\n                borderRadius: 12,\r\n                display: 'inline-block',\r\n                maxWidth: '80%',\r\n                wordWrap: 'break-word',\r\n              }}\r\n            >\r\n              {msg.body}\r\n            </span>\r\n          </div>\r\n        ))}\r\n        <div ref={bottomRef} />\r\n      </div>\r\n\r\n      <form onSubmit={handleSend} style={{ display: 'flex' }}>\r\n        <input\r\n          type=\"text\"\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          placeholder=\"Type a message...\"\r\n          style={{\r\n            flex: 1,\r\n            padding: '8px',\r\n            border: '1px solid #ccc',\r\n            borderRadius: '4px',\r\n            marginRight: '8px',\r\n            fontSize: '14px',\r\n          }}\r\n        />\r\n        <button type=\"submit\" style={{ padding: '8px 12px', border: '1px solid #ccc', borderRadius: '4px', cursor: 'pointer' }}>\r\n          Send\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatBox;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}